name: Update Streak Card

on:
  schedule:
    - cron: "0 6 * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  fetch-streak:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Criar pasta assets
        run: mkdir -p assets

      - name: Baixar streak card atualizado (SVG)
        run: |
          curl -fL --retry 3 --connect-timeout 10 \
            "https://streak-stats.demolab.com?user=CaioGitHub&theme=tokyonight&hide_border=true" \
            -o assets/streak.svg

      - name: Commit e Push se houver alteraÃ§Ãµes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          
          if [ -n "$(git status --porcelain)" ]; then
            git add assets/streak.svg
            git commit -m "chore: update streak card"

            echo "ðŸ”„ Atualizando branch local com o remoto..."
            git pull --rebase origin main
            echo "ðŸš€ Enviando atualizaÃ§Ã£o..."
            git push "https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.git" HEAD:main
          else
            echo "âœ… Sem alteraÃ§Ãµes a serem commitadas"
          fi
